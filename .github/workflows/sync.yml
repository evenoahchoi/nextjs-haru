name: Sync to Synology NAS

on:
  push:
    branches:
      - master  # 'master' 브랜치에 푸시될 때마다 실행

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set Git safe directory
      run: git config --global --add safe.directory /volume1/docker/node/nextjs-haru

    - name: Sync with Synology NAS
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.EXTERNAL_IP }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        port: 2222  # 외부에서 접속할 포트
        script: |
          git config --global --add safe.directory /volume1/docker/node/nextjs-haru
          cd /volume1/docker/node/nextjs-haru
          git pull origin master
          # 아래 명령은 NAS에 설치된 Node.js와 npm을 사용합니다.
          # Node.js와 npm이 설치되어 있고, PATH에 올바르게 설정되어 있어야 합니다.
          # 또한, 필요한 권한을 가지고 있어야 합니다.
          npm install
          npm run build
